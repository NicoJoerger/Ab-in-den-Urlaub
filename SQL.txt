CREATE TABLE IF NOT EXISTS Nutzer
(
	user_id serial PRIMARY KEY,
	username VARCHAR (50) UNIQUE NOT NULL,
	nachname VARCHAR (50) NOT NULL,
	vorname VARCHAR (50) NOT NULL,
	password VARCHAR (50) NOT NULL,
	email VARCHAR (255) UNIQUE NOT NULL,
	tokenstand INT,
	vermieter boolean,
	admin boolean
);

CREATE TABLE IF NOT EXISTS Kreditkartendaten (
	user_id INT NOT NULL,
	kartennummer BIGINT NOT NULL,
	CVV INT NOT NULL,
	FOREIGN KEY (user_id)
		REFERENCES Nutzer (user_id)
);

CREATE TABLE IF NOT EXISTS Ferienwohnung (
	FW_ID serial PRIMARY KEY,
	user_id INT NOT NULL,
	FOREIGN KEY (user_id)
		REFERENCES Nutzer (user_id),
	Straﬂe VARCHAR (70) NOT NULL,
	Ort VARCHAR (70) NOT NULL,
	PLZ INT NOT NULL,
	Wohnflaeche INT NOT NULL,
	AnzZimmer INT NOT NULL,
	AnzBetten INT NOT NULL,
	AnzB‰der INT NOT NULL,
	Wifi boolean NOT NULL,
	Garten boolean NOT NULL,
	Balkon boolean NOT NULL,
	Beschreibung TEXT
);

CREATE TABLE IF NOT EXISTS Bilder (
	Bild_ID serial PRIMARY KEY,
	Bild bytea,
    FOREIGN KEY (FW_ID)
		REFERENCES Ferienwohnung (FW_ID),
	Bild_ID INT NOT NULL,
	FOREIGN KEY (Bild_ID)
		REFERENCES Bilder (Bild_ID)
);

CREATE TABLE IF NOT EXISTS Wohnungsbilder (
	WGB_ID serial PRIMARY KEY,
	FW_ID INT NOT NULL,
    FOREIGN KEY (FW_ID)
		REFERENCES Ferienwohnung (FW_ID),
	Bild_ID INT NOT NULL,
	FOREIGN KEY (Bild_ID)
		REFERENCES Bilder (Bild_ID)
	
);

CREATE TABLE IF NOT EXISTS Tokens (
	Tokenpreis INT NOT NULL
);

CREATE TABLE IF NOT EXISTS Angebote (
	Angebot_ID serial PRIMARY KEY,
	FW_ID INT NOT NULL,
	FOREIGN KEY (FW_ID)
		REFERENCES Ferienwohnung (FW_ID),
	Mietzeitraum_Start timestamp NOT NULL,
	Mietzeitraum_Ende timestamp NOT NULL,
	Auktion_EndDatum timestamp NOT NULL,
	Aktueller_Tokenpreis INT NOT NULL,
	Mietpreis INT NOT NULL,
	Stornierbar boolean NOT NULL
);

CREATE TABLE IF NOT EXISTS Gebot (
	Angebot_ID INT NOT NULL,
	FOREIGN KEY (Angebot_ID)
		REFERENCES Angebote (Angebot_ID),
	user_id INT NOT NULL,
	FOREIGN KEY (user_id)
		REFERENCES Nutzer (user_id),
	Preis INT NOT NULL
);

CREATE TABLE IF NOT EXISTS Bewertung (
    user_id INT NOT NULL,
    FOREIGN KEY (user_id)
        REFERENCES Nutzer (user_id),
    FW_ID INT NOT NULL,
    FOREIGN KEY (FW_ID)
        REFERENCES Ferienwohnung (FW_ID),
    AnzSterne INT NOT NULL,
    Kommentar TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS Rechnungshistorieeintrag (
	RH_ID serial PRIMARY KEY,
	user_id INT NOT NULL,
	FOREIGN KEY (user_id)
		REFERENCES Nutzer (user_id),
	Angebot_ID INT NOT NULL,
	FOREIGN KEY (Angebot_ID)
		REFERENCES Angebote (Angebot_ID),
	Storniert boolean
);	